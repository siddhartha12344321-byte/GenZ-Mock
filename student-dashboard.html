<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GenZMocks - Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #e5e7eb;
            border-radius: 4px;
        }

        @keyframes float-1 {

            0%,
            100% {
                transform: translateY(0) rotate(-3deg);
            }

            50% {
                transform: translateY(-5px) rotate(-3deg);
            }
        }

        @keyframes float-2 {

            0%,
            100% {
                transform: translateY(0) rotate(3deg);
            }

            50% {
                transform: translateY(-5px) rotate(3deg);
            }
        }

        .animate-float-1 {
            animation: float-1 3s ease-in-out infinite;
        }

        .animate-float-2 {
            animation: float-2 4s ease-in-out infinite;
        }
    </style>
</head>

<body class="bg-white text-gray-800 h-screen overflow-hidden">
    <div id="app" class="flex h-screen bg-white font-sans text-gray-900">

        <!-- SIDEBAR - Exact SuperKalam Style -->
        <div class="w-64 h-full bg-white border-r border-gray-200 flex flex-col shrink-0 z-50">
            <div class="p-6 flex items-center gap-3">
                <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center relative">
                    <div class="w-4 h-4 border-2 border-white rounded-full"></div>
                </div>
                <span class="font-bold text-lg text-gray-800 tracking-tight">GenZMocks</span>
            </div>

            <div class="flex-1 overflow-y-auto px-4 custom-scrollbar space-y-6">
                <!-- Section 1 -->
                <div class="space-y-1">
                    <a href="student-dashboard.html"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium bg-blue-50 text-blue-600"
                        data-page="home">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                        </svg>
                        Home
                    </a>
                    <a href="#"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50"
                        data-page="ask" onclick="showPage('ask')">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                        </svg>
                        Ask GenZ AI
                    </a>
                </div>

                <!-- PRELIMS Section -->
                <div>
                    <div class="px-3 mb-2 text-[11px] font-bold text-gray-400 tracking-wider">PRELIMS</div>
                    <div class="space-y-1">
                        <a href="mcq-practice.html"
                            class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <rect x="3" y="3" width="18" height="18" rx="2" stroke-width="2" />
                            </svg>
                            MCQ Practice
                        </a>
                        <a href="pyq.html"
                            class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            Prelims PYQs
                        </a>
                        <a href="tests.html"
                            class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50"
                            data-page="tests">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            My Tests
                        </a>
                    </div>
                </div>

                <!-- Progress Section -->
                <div class="space-y-1">
                    <a href="progress.html"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                        My Progress
                    </a>
                    <a href="leaderboard.html"
                        class="nav-item flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-50">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                        </svg>
                        Leaderboard
                    </a>
                </div>
            </div>

            <!-- Footer -->
            <div class="p-4 border-t border-gray-100">
                <a href="admin/index.html"
                    class="flex items-center gap-3 w-full px-3 py-2 text-sm font-medium text-orange-600 bg-orange-50 rounded-lg hover:bg-orange-100 mb-2">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                    Admin Panel
                </a>
                <button onclick="logout()"
                    class="flex items-center gap-3 w-full px-3 py-2 text-sm text-gray-600 hover:text-gray-900 font-medium mb-2">
                    <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Logout
                </button>
                <div class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50">
                    <div class="w-8 h-8 rounded-full bg-gray-200 overflow-hidden flex items-center justify-center text-sm font-medium text-gray-600"
                        id="userAvatar">U</div>
                    <div class="overflow-hidden">
                        <div class="text-sm font-medium text-gray-900 truncate" id="userName">User</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MAIN CONTENT AREA -->
        <main class="flex-1 h-full overflow-hidden relative">

            <!-- HOME VIEW -->
            <div id="homeView" class="h-full flex flex-col bg-gray-50">
                <header class="bg-white h-14 border-b border-gray-200 px-6 flex items-center justify-between shrink-0">
                    <span class="text-gray-900 font-medium">Home</span>
                </header>
                <div class="flex-1 p-8 overflow-y-auto custom-scrollbar">
                    <div class="flex gap-6 max-w-7xl mx-auto">
                        <!-- Left Stats -->
                        <div class="flex-1">
                            <h2 class="text-lg font-bold text-gray-800 mb-4">Today's Activity</h2>
                            <div class="grid grid-cols-2 gap-4">
                                <div
                                    class="bg-white p-6 rounded-xl border border-gray-100 flex flex-col items-center justify-center h-48 shadow-sm">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                        class="mb-3 text-orange-500">
                                        <rect x="3" y="3" width="7" height="7" stroke="currentColor" stroke-width="2" />
                                    </svg>
                                    <div class="text-3xl font-bold text-gray-900" id="mcqCount">0</div>
                                    <div class="text-sm text-gray-500 mt-1">MCQ Practiced</div>
                                </div>
                                <div
                                    class="bg-white p-6 rounded-xl border border-gray-100 flex flex-col items-center justify-center h-48 shadow-sm">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                        class="mb-3 text-blue-500">
                                        <path d="M13 10V3L4 14h7v7l9-11h-7z" stroke="currentColor" stroke-width="2" />
                                    </svg>
                                    <div class="text-3xl font-bold text-gray-900" id="accuracyVal">-</div>
                                    <div class="text-sm text-gray-500 mt-1">Accuracy</div>
                                </div>
                                <div
                                    class="bg-white p-6 rounded-xl border border-gray-100 flex flex-col items-center justify-center h-48 shadow-sm">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                        class="mb-3 text-green-500">
                                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor"
                                            stroke-width="2" />
                                    </svg>
                                    <div class="text-3xl font-bold text-gray-900" id="testsCount">0</div>
                                    <div class="text-sm text-gray-500 mt-1">Tests Completed</div>
                                </div>
                                <div
                                    class="bg-white p-6 rounded-xl border border-gray-100 flex flex-col items-center justify-center h-48 shadow-sm">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                        class="mb-3 text-yellow-500">
                                        <path d="M3 21v-8a2 2 0 012-2h14a2 2 0 012 2v8M9 10a2 2 0 012-2h2a2 2 0 012 2"
                                            stroke="currentColor" stroke-width="2" />
                                    </svg>
                                    <div class="text-3xl font-bold text-gray-900" id="rankVal">-</div>
                                    <div class="text-sm text-gray-500 mt-1">Your Rank</div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Leaderboard -->
                        <div class="w-80 bg-white border border-gray-200 rounded-xl flex flex-col h-[520px]">
                            <div class="flex border-b border-gray-100">
                                <button
                                    class="flex-1 py-3 text-orange-600 font-semibold border-b-2 border-orange-500 text-sm">Leaderboard</button>
                                <button class="flex-1 py-3 text-gray-400 font-medium text-sm hover:text-gray-700">PYQ
                                    Practice</button>
                            </div>
                            <div class="p-4 flex-1 flex flex-col">
                                <h3 class="text-sm font-bold text-gray-800 mb-3">Today's Leaderboard</h3>
                                <div class="bg-blue-50 p-3 rounded-lg flex justify-between items-center mb-4">
                                    <div class="text-[11px] text-blue-800 leading-tight w-2/3">Practice MCQs now & see
                                        your rank in the leaderboard</div>
                                    <a href="mcq-practice.html"
                                        class="bg-blue-600 text-white text-[10px] font-bold px-3 py-1.5 rounded hover:bg-blue-700 whitespace-nowrap">Practice
                                        Now</a>
                                </div>
                                <div class="flex text-[10px] text-gray-400 font-bold mb-2 px-2 uppercase tracking-wide">
                                    <div class="w-8">Rank</div>
                                    <div class="flex-1">Student</div>
                                    <div class="w-12 text-right">Marks</div>
                                    <div class="w-12 text-right">Accuracy</div>
                                </div>
                                <div class="flex-1 overflow-y-auto custom-scrollbar" id="leaderboardList">
                                    <!-- Leaderboard items -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ASK GENZ AI VIEW -->
            <div id="askView" class="h-full flex-col bg-white relative hidden">
                <div class="flex-1 flex flex-col items-center justify-center p-4 w-full max-w-3xl mx-auto">
                    <div
                        class="absolute top-6 left-1/2 -translate-x-1/2 bg-blue-50 text-blue-800 px-4 py-1.5 rounded-full text-xs font-bold border border-blue-100">
                        âš¡ Powered by Groq AI
                    </div>

                    <div
                        class="w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mb-6 shadow-xl shadow-blue-200 ring-4 ring-blue-50">
                        <span class="text-white text-2xl font-bold">GZ</span>
                    </div>

                    <h1 class="text-2xl font-bold text-gray-900 mb-2">Ask GenZ AI</h1>
                    <p class="text-gray-500 mb-8">Your AI-powered study companion</p>

                    <div class="flex gap-3 mb-8">
                        <button
                            class="flex items-center gap-2 px-6 py-2 border border-blue-500 text-blue-500 rounded bg-white hover:bg-blue-50 font-bold text-xs tracking-wide">
                            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
                                viewBox="0 0 24 24">
                                <path
                                    d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253" />
                            </svg> LEARN
                        </button>
                        <button
                            class="flex items-center gap-2 px-6 py-2 border border-blue-500 text-blue-500 rounded bg-white hover:bg-blue-50 font-bold text-xs tracking-wide">
                            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2"
                                viewBox="0 0 24 24">
                                <path
                                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg> PRACTICE
                        </button>
                        <button
                            class="flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 font-bold text-xs tracking-wide shadow-md">
                            <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                <circle cx="12" cy="7" r="4" />
                            </svg> UPSC GUIDE
                        </button>
                    </div>

                    <!-- Quick Questions -->
                    <div class="w-full space-y-2 mb-6">
                        <div class="question-btn flex justify-between items-center p-3.5 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer text-gray-700 text-sm border border-gray-100 group transition-all"
                            onclick="askQuestion('Explain the concept of Fundamental Rights in India')">
                            <span>Explain the concept of <b>Fundamental Rights</b> in India</span>
                            <svg width="16" height="16" stroke="currentColor" fill="none"
                                class="text-gray-300 group-hover:text-gray-500" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                        <div class="question-btn flex justify-between items-center p-3.5 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer text-gray-700 text-sm border border-gray-100 group transition-all"
                            onclick="askQuestion('What are the Directive Principles of State Policy?')">
                            <span>What are the <b>Directive Principles</b> of State Policy?</span>
                            <svg width="16" height="16" stroke="currentColor" fill="none"
                                class="text-gray-300 group-hover:text-gray-500" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                        <div class="question-btn flex justify-between items-center p-3.5 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer text-gray-700 text-sm border border-gray-100 group transition-all"
                            onclick="askQuestion('Explain the Indian Parliamentary System')">
                            <span>Explain the <b>Indian Parliamentary System</b></span>
                            <svg width="16" height="16" stroke="currentColor" fill="none"
                                class="text-gray-300 group-hover:text-gray-500" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 5l7 7-7 7" />
                            </svg>
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <div class="w-full relative">
                        <input type="text" id="chatInput"
                            placeholder="Ask me anything about UPSC, current affairs, polity..."
                            class="w-full p-4 pr-12 rounded-xl border border-gray-200 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-100 focus:border-blue-400 text-sm text-gray-700 placeholder-gray-400"
                            onkeypress="if(event.key==='Enter') sendMessage()">
                        <button onclick="sendMessage()"
                            class="absolute right-3 top-3 p-1.5 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"
                                viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Chat Messages Container (Hidden initially) -->
                <div id="chatContainer" class="hidden h-full flex flex-col">
                    <header class="bg-white h-14 border-b border-gray-200 px-6 flex items-center gap-3 shrink-0">
                        <button onclick="resetChat()" class="text-gray-400 hover:text-gray-600">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 19l-7-7 7-7" />
                            </svg>
                        </button>
                        <div
                            class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                            <span class="text-white text-xs font-bold">GZ</span>
                        </div>
                        <span class="font-medium text-gray-900">GenZ AI</span>
                    </header>
                    <div id="chatMessages" class="flex-1 overflow-y-auto p-6 space-y-4 custom-scrollbar">
                        <!-- Messages will appear here -->
                    </div>
                    <div class="p-4 border-t border-gray-200 bg-white">
                        <div class="relative max-w-3xl mx-auto">
                            <input type="text" id="chatInputBottom" placeholder="Type your message..."
                                class="w-full p-4 pr-12 rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-100 focus:border-blue-400 text-sm"
                                onkeypress="if(event.key==='Enter') sendMessage()">
                            <button onclick="sendMessage()"
                                class="absolute right-3 top-3 p-1.5 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                        d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script src="js/admin-data.js"></script>
    <script>
        // Groq API Configuration
        const GROQ_API_KEY = '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';
        const GROQ_MODEL = 'llama-3.3-70b-versatile';

        let chatHistory = [];

        // Check login
        document.addEventListener('DOMContentLoaded', () => {
            const userData = JSON.parse(localStorage.getItem('user_data') || '{}');
            if (!userData.key && !userData.name) {
                window.location.href = 'index.html';
                return;
            }
            const userName = userData.name || userData.key || 'User';
            document.getElementById('userName').textContent = userName;
            document.getElementById('userAvatar').textContent = userName.charAt(0).toUpperCase();

            loadLeaderboard();
        });

        function logout() {
            localStorage.removeItem('user_data');
            window.location.href = 'index.html';
        }

        function showPage(page) {
            document.getElementById('homeView').classList.add('hidden');
            document.getElementById('askView').classList.add('hidden');

            if (page === 'home') {
                document.getElementById('homeView').classList.remove('hidden');
            } else if (page === 'ask') {
                document.getElementById('askView').classList.remove('hidden');
                document.getElementById('askView').classList.add('flex');
            }

            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('bg-blue-50', 'text-blue-600');
                item.classList.add('text-gray-600');
            });
            const activeNav = document.querySelector(`[data-page="${page}"]`);
            if (activeNav) {
                activeNav.classList.add('bg-blue-50', 'text-blue-600');
                activeNav.classList.remove('text-gray-600');
            }
        }

        function loadLeaderboard() {
            const leaders = [
                { name: 'Mrigendra', questions: 341, score: 618, accuracy: 93 },
                { name: 'Hanifa', questions: 120, score: 163, accuracy: 76 },
                { name: 'Rahul V.', questions: 98, score: 142, accuracy: 82 },
                { name: 'Sneha G.', questions: 75, score: 108, accuracy: 79 }
            ];

            document.getElementById('leaderboardList').innerHTML = leaders.map((l, i) => `
                <div class="flex items-center p-2 hover:bg-gray-50 rounded mb-1">
                    <div class="w-8"><div class="w-5 h-5 ${i === 0 ? 'bg-yellow-100 text-yellow-600' : 'bg-gray-100 text-gray-500'} rounded-full flex items-center justify-center text-[10px] font-bold">${i + 1}</div></div>
                    <div class="flex-1 min-w-0"><div class="text-xs font-bold text-gray-900">${l.name}</div><div class="text-[10px] text-gray-500">${l.questions} questions</div></div>
                    <div class="w-12 text-right text-xs font-bold text-gray-900">${l.score}</div>
                    <div class="w-12 text-right text-xs text-green-500 font-bold">${l.accuracy}%</div>
                </div>
            `).join('');
        }

        function askQuestion(question) {
            document.getElementById('chatInput').value = question;
            sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('chatInput').value || document.getElementById('chatInputBottom')?.value;
            if (!input?.trim()) return;

            // Show chat container
            document.querySelector('#askView > div:first-child').classList.add('hidden');
            document.getElementById('chatContainer').classList.remove('hidden');

            // Add user message
            addMessage(input, 'user');
            chatHistory.push({ role: 'user', content: input });

            // Clear inputs
            document.getElementById('chatInput').value = '';
            if (document.getElementById('chatInputBottom')) {
                document.getElementById('chatInputBottom').value = '';
            }

            // Show typing indicator
            const typingId = addMessage('Thinking...', 'ai', true);

            try {
                const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${GROQ_API_KEY}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: GROQ_MODEL,
                        messages: [
                            { role: 'system', content: 'You are GenZ AI, an intelligent study assistant for UPSC and competitive exam preparation. Provide clear, concise, and accurate answers. Format your responses with proper structure using bullet points and headings where appropriate. Be encouraging and helpful.' },
                            ...chatHistory
                        ],
                        temperature: 0.7,
                        max_tokens: 1500
                    })
                });

                const data = await response.json();
                const aiResponse = data.choices[0]?.message?.content || 'Sorry, I could not process your request.';

                // Remove typing indicator
                document.getElementById(typingId)?.remove();

                // Add AI response
                addMessage(aiResponse, 'ai');
                chatHistory.push({ role: 'assistant', content: aiResponse });

            } catch (error) {
                document.getElementById(typingId)?.remove();
                addMessage('Sorry, there was an error connecting to the AI. Please try again.', 'ai');
            }
        }

        function addMessage(text, sender, isTyping = false) {
            const container = document.getElementById('chatMessages');
            const id = 'msg-' + Date.now();

            const msgHtml = sender === 'user'
                ? `<div id="${id}" class="flex justify-end"><div class="bg-blue-600 text-white px-4 py-3 rounded-2xl rounded-tr-sm max-w-[70%] text-sm">${text}</div></div>`
                : `<div id="${id}" class="flex gap-3"><div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center shrink-0"><span class="text-white text-xs font-bold">GZ</span></div><div class="bg-gray-100 px-4 py-3 rounded-2xl rounded-tl-sm max-w-[70%] text-sm text-gray-800 ${isTyping ? 'animate-pulse' : ''}">${isTyping ? '<span class="inline-flex gap-1"><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></span><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></span><span class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></span></span>' : text.replace(/\n/g, '<br>')}</div></div>`;

            container.insertAdjacentHTML('beforeend', msgHtml);
            container.scrollTop = container.scrollHeight;
            return id;
        }

        function resetChat() {
            chatHistory = [];
            document.getElementById('chatMessages').innerHTML = '';
            document.getElementById('chatContainer').classList.add('hidden');
            document.querySelector('#askView > div:first-child').classList.remove('hidden');
        }
    </script>
</body>

</html>